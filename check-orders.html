<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Check Your Orders</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(to right, #f0f2f5, #d9e2ec);
  }

  .container {
    max-width: 600px;
    margin: 80px auto;
    background: #fff;
    padding: 30px 25px;
    border-radius: 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
  }

  h2 {
    text-align: center;
    margin-bottom: 25px;
    color: #222;
  }

  input {
    width: 100%;
    padding: 12px 15px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.3s;
  }

  input:focus {
    border-color: #000;
  }

  button {
    width: 100%;
    padding: 12px;
    background: #000;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 10px;
    transition: 0.3s;
  }

  button:hover {
    background: #333;
  }

  .error {
    color: red;
    text-align: center;
    margin-top: 10px;
  }

  .orders {
    margin-top: 20px;
    max-height: 400px;
    overflow-y: auto;
  }

  .order {
    background: #f9f9f9;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  .order h4 {
    margin: 0 0 10px;
    color: #111;
  }

  .order p {
    margin: 5px 0;
    color: #555;
  }

  .order ul {
    margin: 10px 0 0 20px;
    padding: 0;
  }

  .order ul li {
    margin-bottom: 4px;
  }

  .home-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #000;
    color: #fff;
    padding: 10px 18px;
    border-radius: 50px;
    text-decoration: none;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transition: 0.3s;
  }

  .home-btn::before {
    content: "üè†";
  }

  .home-btn:hover {
    background: #fff;
    color: #000;
  }

  @media (max-width: 600px) {
    .container { margin: 60px 15px; padding: 25px; }
    .home-btn { top: 15px; right: 15px; padding: 8px 14px; font-size: 14px; }
  }
</style>
</head>
<body>

<a href="index.html" class="home-btn">Home</a>

<div class="container">
  <h2>Check Your Orders</h2>
  <input type="email" id="email" placeholder="Enter your email" required />
  <input type="password" id="password" placeholder="Enter your password" required />
  <button onclick="checkOrders()">View Orders</button>
  <div id="feedback" class="error"></div>
  <div class="orders" id="orders"></div>
</div>

<script>
async function checkOrders() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const feedback = document.getElementById("feedback");
  const ordersContainer = document.getElementById("orders");

  feedback.textContent = "";
  ordersContainer.innerHTML = "";

  if (!email || !password) {
    feedback.textContent = "Please enter both email and password.";
    return;
  }

  try {
    const loginRes = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    });

    const loginData = await loginRes.json();
    if (!loginRes.ok || !loginData.token) {
      feedback.textContent = loginData.error || "Login failed. Please try again.";
      return;
    }

    const token = loginData.token;

    const ordersRes = await fetch("/api/my-orders", {
      headers: { "Authorization": `Bearer ${token}` }
    });

    const ordersData = await ordersRes.json();
    if (!ordersRes.ok || !ordersData.success) {
      feedback.textContent = ordersData.error || "Could not fetch orders.";
      return;
    }

    const orders = ordersData.orders;
    if (!orders || orders.length === 0) {
      ordersContainer.innerHTML = "<p>No orders found.</p>";
      return;
    }

    ordersContainer.innerHTML = "";
    orders.forEach(order => {
      const div = document.createElement("div");
      div.className = "order";

      const itemsHtml = order.items && order.items.length
        ? order.items.map(item => `<li>${item.product} x ${item.quantity} (${item.size || '-'}) - Rs.${item.price}</li>`).join('')
        : "<li>No items</li>";

      div.innerHTML = `
        <h4>Order #${order.order_number}</h4>
        <p><strong>Total:</strong> Rs.${order.total_amount}</p>
        <p><strong>Status:</strong> ${order.status}</p>
        <p><strong>Shipping Address:</strong> ${order.shipping_address || "N/A"}</p>
        <p><strong>Date:</strong> ${new Date(order.created_at).toLocaleString()}</p>
        <p><strong>Items:</strong></p>
        <ul>${itemsHtml}</ul>
      `;
      ordersContainer.appendChild(div);
    });

  } catch (err) {
    console.error("Unexpected error:", err);
    feedback.textContent = "Something went wrong. Please try again later.";
  }
}
</script>
</body>
</html>
